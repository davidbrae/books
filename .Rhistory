library(tidyverse)
library(readxl)
books <- read_xlsx('~/Desktop/books/Books.xlsx')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
books %>%
group_by(Year,Gender) %>%
summarize(n=n()) %>%
pivot_wider(names_from = Gender,values_from=n)
library(tidyverse)
library(readxl)
books <- read_xlsx('~/Desktop/books/Books.xlsx')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
books %>%
group_by(Year,Gender) %>%
summarize(n=n()) %>%
pivot_wider(names_from = Gender,values_from=n)
books %>%
group_by(month) %>%
summarize(n())
books %>%
group_by(Month) %>%
summarize(n())
books %>%
filter(Year>2012) %>%
group_by(Month) %>%
summarize(n())
library(readxl)
library(readr)
books <- read_csv('~/Desktop/books/Books.csv')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
library(tidyverse)
library(readxl)
library(readr)
books <- read_csv('~/Desktop/books/Books.csv')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
books %>%
group_by(Year,Gender) %>%
summarize(n=n()) %>%
pivot_wider(names_from = Gender,values_from=n)
books %>%
filter(Year>2012) %>%
group_by(Month) %>%
summarize(n=n()) %>%
arrange(n)
library(tidyverse)
library(readxl)
library(readr)
books <- read_csv('~/Desktop/books/Books.csv')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
library(tidyverse)
library(readxl)
library(readr)
books <- read_csv('~/Desktop/books/Books.csv')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
books %>%
group_by(Year,Gender) %>%
summarize(n=n()) %>%
pivot_wider(names_from = Gender,values_from=n)
books %>%
filter(Year>2012) %>%
group_by(Month) %>%
summarize(n=n()) %>%
arrange(n)
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
Bulgaria
library(SampleFrames)
Bulgaria %>% select(NUTS1, NUTS2, Provinces) %>% summarize(n())
Bulgaria %>% select(NUTS1, NUTS2, Province) %>% summarize(n())1
Bulgaria %>% select(NUTS1, NUTS2, Province) %>% summarize(n())
Bulgaria %>% group_by(NUTS1, NUTS2, Province) %>% summarize(n())
Bulgaria %>% group_by(NUTS1, NUTS2, Province) %>% summarize(n()) %>% data.frame()
library(SampleFrames)
library(SurveyAssist)
library(sf)
library(mapview)
library(tidyverse)
library(readxl)
Bulgaria <- Bulgaria %>%
group_by(NUTS1, NUTS2, Province, Municipality, Settlement, Urbanicity) %>%
summarize(Total = sum(Total))
access <- read_excel("~/Desktop/Europe/EuropeW4/Accessibility Trackers/Bulgaria_Accessibility Tracker.xlsx") %>%
select(-Total)
bulgaria18_29 <- read_excel('~/Desktop/Europe/MS/Macbeth/W2/Bulgaria/Bulgaria Census Ages 18-28.xlsx', sheet = 2) %>%
filter(filter == "Inactive") %>%
select(NUTS1, NUTS2, Province = Dobrich, Municipality = '...4', Settlement, AgeTotal ) %>%
mutate(Settlement = tolower(Settlement)) %>%
group_by(NUTS1, NUTS2, Province, Municipality, Settlement) %>%
summarize(AgeTotal = sum(AgeTotal))
bulgaria18_29 <- Bulgaria %>%
left_join(bulgaria18_29) %>%
mutate(Total = AgeTotal) %>%
select(-AgeTotal)
strattable <- strat_d3(bulgaria18_29,'Province',107, access)
strattable
strattable %>% group_by(Province) %>% summarize(sum(Total))
strattable %>% group_by(Province) %>% summarize(Total = sum(Total))
strattable %>% group_by(Province) %>% summarize(Total = sum(Total)) %>% write_csv('~/Desktop/test.csv')
bulgaria18_29
access <- read_excel("~/Desktop/Europe/EuropeW4/Accessibility Trackers/Bulgaria_Accessibility Tracker.xlsx") %>%
select(-Total) %>%
mutate(Accessibility = 'Yes')
access
access <- read_excel("~/Desktop/Europe/EuropeW4/Accessibility Trackers/Bulgaria_Accessibility Tracker.xlsx") %>%
select(-Total) %>%
mutate(Accessibility = 'Yes')
bulgaria18_29 <- read_excel('~/Desktop/Europe/MS/Macbeth/W2/Bulgaria/Bulgaria Census Ages 18-28.xlsx', sheet = 2) %>%
filter(filter == "Inactive") %>%
select(NUTS1, NUTS2, Province = Dobrich, Municipality = '...4', Settlement, AgeTotal ) %>%
mutate(Settlement = tolower(Settlement)) %>%
group_by(NUTS1, NUTS2, Province, Municipality, Settlement) %>%
summarize(AgeTotal = sum(AgeTotal))
bulgaria18_29 <- Bulgaria %>%
left_join(bulgaria18_29) %>%
mutate(Total = AgeTotal) %>%
select(-AgeTotal)
strattable <- strat_d3(bulgaria18_29,'Province',107, access)
strattable %>% group_by(Province) %>% summarize(Total = sum(Total)) %>% write_csv('~/Desktop/test.csv')
#--------------------------------------------------------------------------------------------------------------------
#--------------------------------------------------------------------------------------------------------------------
#--------------------------------------------------------------------------------------------------------------------
options(tibble.width=Inf)
options(tibble.length=Inf)
options(survey.lonely.psu="adjust")
library(haven)
library(survey)
library(tidyverse)
library(readxl)
library(SampleFrames)
library(SurveyAssist)
library(officer)
#dataset
poland <- read_sav('~/Desktop/Poland National Survey W1 Data v0.3.sav')
#targets
targets <- read_excel("~/Desktop/Poland Macbeth W1 Population Parameters.xlsx")
#dataset
poland <- read_sav('~/Desktop/Poland National Survey W1 Data v0.3.sav')
#targets
targets <- read_excel("~/Desktop/Poland Macbeth W1 Population Parameters.xlsx")
pulsingratio<- read_excel('~/Desktop/Poland MacBeth W1 Pulsing Ratios.xlsx')
#dataset
poland <- read_sav('~/Desktop/Europe/MS/Macbeth/Poland/Desktop/Poland National Survey W1 Data v0.3.sav')
#targets
targets <- read_excel("~/Desktop/Europe/MS/Macbeth/Poland/Poland Macbeth W1 Population Parameters.xlsx")
pulsingratio<- read_excel('~/Desktop/Europe/MS/Macbeth/Poland/Poland MacBeth W1 Pulsing Ratios.xlsx')
#dataset
poland <- read_sav('~/Desktop/Europe/MS/Macbeth/Poland/Desktop/Poland National Survey W1 Data v0.3.sav')
#dataset
poland <- read_sav('~/Desktop/Europe/MS/Macbeth/Poland/Poland National Survey W1 Data v0.3.sav')
#targets
targets <- read_excel("~/Desktop/Europe/MS/Macbeth/Poland/Poland Macbeth W1 Population Parameters.xlsx")
pulsingratio<- read_excel('~/Desktop/Europe/MS/Macbeth/Poland/Poland MacBeth W1 Pulsing Ratios.xlsx')
names(pulsingratio) <- make.names(names(pulsingratio))
baseweights <- pulsingratio %>%
select(Provider, N = Frame.size, n = Delivered.numbers,Mode) %>%
mutate(Provider = case_when(Mode == 'Landline' ~ 'Landline',
TRUE ~ Provider)) %>%
group_by(Provider) %>%
summarize(N = sum(N), n = sum(n)) %>%
ungroup() %>%
filter(n != 0) %>%
mutate(basewgt = N / n)
poland <- poland %>% mutate(Provider = as_factor(MobileProvider))
poland <- poland %>%
mutate(Provider = case_when(Mode == 2 ~ 'Landline',
TRUE ~ as.character(as_factor(Provider)))) %>%
#mutate(Provider = case_when(Provider == 'Mundio Mobile' ~ 'P4 (Play)', #mode impute an impossible provider code
#TRUE ~ Provider)) %>%
left_join(baseweights)
poland
#--------------------------------------------------------------------------------------------------------------------
#-----------------------------------Calculate the Raked Weights--------------------------------------------
#--------------------------------------------------------------------------------------------------------------------
poland$D2
df_var_names(poland)
poland$C2
table(poland$C2)
sum(poland$C2<39)
poland18_38 <- read_sav('~/Desktop/Europe/MS/Macbeth/Poland/Poland National Survey W1 (18-38) Weighted Data v1')
poland18_38 <- read_sav('~/Desktop/Europe/MS/Macbeth/Poland/Poland National Survey W1 (18-38) Weighted Data v1.sav')
nrow(poland18_38)
pop_gender <- targets %>%
slice(7:8) %>%
select(1,2) %>%
rename('C1' = 1, 'Freq' = 2) %>%
mutate(Freq = as.numeric(Freq)) %>%
mutate(Freq = Freq / sum(Freq))
pop_gender
#targets
targets <- read_excel("~/Desktop/Europe/MS/Macbeth/Poland/Poland Macbeth 18-38 W1 Population Parameters.xlsx")
pop_gender <- targets %>%
slice(7:8) %>%
select(1,2) %>%
rename('C1' = 1, 'Freq' = 2) %>%
mutate(Freq = as.numeric(Freq)) %>%
mutate(Freq = Freq / sum(Freq))
targets %>%
slice(16:20)
targets %>%
slice(16:18)
pop_age <- targets %>%
slice(16:18) %>%
select(1,2) %>%
rename('AgeGroup' = 1, 'Freq' = 2) %>%
mutate(Freq = as.numeric(Freq)) %>%
mutate(Freq = Freq / sum(Freq))
targets %>%
slice(28:43)
targets %>%
slice(26:41)
#Region
pop_ethnic <- targets %>%
slice(71:73) %>%
select(1,2) %>%
rename('EthnicGroup' = 1, 'Freq' = 2) %>%
mutate(Freq = as.numeric(Freq)) %>%
mutate(Freq = Freq / sum(Freq))
pop_ethnic
#Region
pop_region <- targets %>%
slice(26:41) %>%
select(1,2) %>%
rename('A7' = 1, 'Freq' = 2) %>%
mutate(Freq = as.numeric(Freq)) %>%
mutate(Freq = Freq / sum(Freq)) %>%
mutate(A7 = str_split_i(A7, "\\(", i = -1))  %>%
mutate(A7 = str_replace(A7,"\\)",""))
poland <- poland %>%
mutate( C1 = as.character(as_factor(C1)),
AgeGroup = as_factor(AgeGroup),
A7 = as_factor(A7),
EducGroup = as_factor(EducGroup),
EthnicGroup = as_factor(EthnicGroup)) %>%
mutate(C1 = str_split_i(C1, ". ", i = -1)) %>%
mutate(A7 = str_split_i(A7, "\\.", i = -1))  %>%
mutate(A7= str_trim(A7)) %>%
mutate(A7 = case_when(A7 == "Warmińsko- Warmia-Masuria" ~ "Warmia-Masuria",
TRUE ~ A7))
pop_age
poland$C2
table(poland$C2)
poland <- poland %>%
mutate( C1 = as.character(as_factor(C1)),
AgeGroup = case_when(C2 < 25 ~ '18-24',
C2>24 & C2<32 ~ '25-31',
C2>31 ~ '32-38'),
A7 = as_factor(A7),
EducGroup = as_factor(EducGroup),
EthnicGroup = as_factor(EthnicGroup)) %>%
mutate(C1 = str_split_i(C1, ". ", i = -1)) %>%
mutate(A7 = str_split_i(A7, "\\.", i = -1))  %>%
mutate(A7= str_trim(A7)) %>%
mutate(A7 = case_when(A7 == "Warmińsko- Warmia-Masuria" ~ "Warmia-Masuria",
TRUE ~ A7))
esttarg(C1,pop_gender, poland)
esttarg(AgeGroup,pop_age, poland)
esttarg(A7,pop_region,poland)
poland %>% filter(C2 < 39)
poland <- poland %>% filter(C2 < 39)
poland <- poland %>%
mutate( C1 = as.character(as_factor(C1)),
AgeGroup = case_when(C2 < 25 ~ '18-24',
C2>24 & C2<32 ~ '25-31',
C2>31 ~ '32-38'),
A7 = as_factor(A7),
EducGroup = as_factor(EducGroup),
EthnicGroup = as_factor(EthnicGroup)) %>%
mutate(C1 = str_split_i(C1, ". ", i = -1)) %>%
mutate(A7 = str_split_i(A7, "\\.", i = -1))  %>%
mutate(A7= str_trim(A7)) %>%
mutate(A7 = case_when(A7 == "Warmińsko- Warmia-Masuria" ~ "Warmia-Masuria",
TRUE ~ A7))
esttarg(C1,pop_gender, poland)
esttarg(AgeGroup,pop_age, poland)
esttarg(A7,pop_region,poland)
esttarg(EthnicGroup,pop_ethnic, poland)
#main sample design
svy_poland<- svydesign( id = ~1  ,strata = ~Mode, weights = ~basewgt , data = poland )
rake_poland<- rake(svy_poland, sample=list(~C1,~AgeGroup, ~A7, ~EthnicGroup),
population=list(pop_gender,pop_age, pop_region,pop_ethnic),control=list(maxit=50))
poland$trim_wgt <- weights(trimweights_D3(rake_poland))
poland$wgt <- poland$trim_wgt * nrow( poland ) / sum(poland$trim_wgt)
attributes(poland$wgt)$label <- 'Base weight calibrated weight by age, gender, region, and ethnicity'
poland %>%
select(A1,wgt) %>%
write_sav('~/Desktop/MS Macbeth Poland 18-38 Weights v.1.sav')
svy_poland <- svydesign( id = ~1, strata = ~Mode  , weights = ~wgt , data=poland )
dd <- svymean( ~as_factor( D1 ) , svy_poland , deff = "replace" , na.rm = TRUE )
d3_moe(n=nrow(svy_poland), deff =  round(weighted.mean(deff(dd)[!is.na(deff(dd))],svytable(~D1, svy_poland)),2))
attributes(poland$wgt)$label <- 'Base weight calibrated weight by age, gender, region, and ethnicity'
poland %>%
select(A1,wgt) %>%
write_sav('~/Desktop/Europe/MS/Macbeth/Poland/MS Macbeth Poland 18-38 Weights v.1.sav')
svy_poland <- svydesign( id = ~1, strata = ~Mode  , weights = ~wgt , data=poland )
dd <- svymean( ~as_factor( D1 ) , svy_poland , deff = "replace" , na.rm = TRUE )
d3_moe(n=nrow(svy_poland), deff =  round(weighted.mean(deff(dd)[!is.na(deff(dd))],svytable(~D1, svy_poland)),2))
rm(doc)
doc <- exportMOE(deffvar = 'D1', finaldesign <- 'svy_poland',rakeddesign <- 'rake_poland', unweighteddata = 'poland' )
print(doc, target = "~/Desktop/Europe/MS/Macbeth/Poland/MS Macbeth Poland MOE and Deff wgt v.1.docx")
exportPPS
library(SampleFrames)
library(SurveyAssist)
library(sf)
library(mapview)
library(tidyverse)
library(readxl)
Bulgaria <- Bulgaria %>%
group_by(NUTS1, NUTS2, Province, Municipality, Settlement, Urbanicity) %>%
summarize(Total = sum(Total))
access <- read_excel("~/Desktop/Europe/EuropeW4/Accessibility Trackers/Bulgaria_Accessibility Tracker.xlsx") %>%
select(-Total) %>%
mutate(Accessibility = 'Yes')
bulgaria18_29 <- read_excel('~/Desktop/Europe/MS/Macbeth/W2/Bulgaria/Bulgaria Census Ages 18-28.xlsx', sheet = 2) %>%
filter(filter == "Inactive") %>%
select(NUTS1, NUTS2, Province = Dobrich, Municipality = '...4', Settlement, AgeTotal ) %>%
mutate(Settlement = tolower(Settlement)) %>%
group_by(NUTS1, NUTS2, Province, Municipality, Settlement) %>%
summarize(AgeTotal = sum(AgeTotal))
bulgaria18_29 <- Bulgaria %>%
left_join(bulgaria18_29) %>%
mutate(Total = AgeTotal) %>%
select(-AgeTotal)
strattable <- strat_d3(bulgaria18_29,'Province',107, access)
bulgaria18_29 <- bulgaria18_29 %>%
filter(Total > 30)
exportPPS <- bulgaria18_29 %>%
right_join(access) %>%
filter(Accessibility %in% c("Yes","yes")) %>%
left_join(select(strattable,-c(Total))) %>%
group_by(NUTS2) %>%
filter(!is.na(Total)&clusters>0) %>%
arrange(Province, Municipality, desc(Total), .by_group = TRUE) %>%
do(ppss_dplyr2(.)) 	%>%
select(-c(Accessibility,Prop,clusters)) %>%
ungroup() %>%
mutate(SP = 1:n()) %>%
select(-c(interval,startingpoint))
exportPPS
Replacementdraw3
exportPPS <-readxl::read_excel('~/Desktop/Europe/MS/Macbeth/W2/Bulgaria/MS W2 Bulgaria 18-28 Sample Draw.xlsx',  sheet ='Draw')
Replacementdraw2 <- readxl::read_excel( '~/Desktop/Europe/MS/Macbeth/W2/Bulgaria/MS W2 Bulgaria 18-28 Sample Draw.xlsx', sheet = "Replacement1")
Replacementdraw3<- readxl::read_excel( '~/Desktop/Europe/MS/Macbeth/W2/Bulgaria/MS W2 Bulgaria 18-28 Sample Draw.xlsx',  sheet = "Replacement2")
exportPPS
exportPPS %>%
left_join(Bulgaria)
exportPPS %>%
right_join(Bulgaria)
Bulgaria
exportPPS %>%
right_join(select(Bulgaria,-Total))
Bulgaria
library(tidyverse)
library(readxl)
library(readr)
books <- read_csv('~/Desktop/books/Books.csv')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
books %>%
group_by(Year,Gender) %>%
summarize(n=n()) %>%
pivot_wider(names_from = Gender,values_from=n)
books %>%
filter(Year>2012) %>%
group_by(Month) %>%
summarize(n=n()) %>%
arrange(n)
13993/12
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
17223/12
13993/8
13993/240
17223/365
14465/365
library(tidyverse)
library(readxl)
library(readr)
books <- read_csv('~/Desktop/books/Books.csv')
books %>%
group_by(Year) %>%
summarize(n(),sum(Pages),mean(Pages))
